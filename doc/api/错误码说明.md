# 错误码说明文档

## 概述

本文档定义了 User Center 系统中所有可能出现的错误码及其含义，帮助开发者快速定位和解决问题。

## 错误码格式

错误码采用 HTTP 状态码 + 业务错误码的组合形式：

- **HTTP 状态码**: 标准的 HTTP 响应状态码
- **业务错误码**: 系统内部定义的具体错误码

## 通用错误码

### 2xx 成功状态码

| 错误码 | 说明 | 描述 |
|--------|------|------|
| 200 | 成功 | 请求处理成功 |
| 201 | 创建成功 | 资源创建成功 |
| 204 | 无内容 | 请求成功但无返回内容 |

### 4xx 客户端错误

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 400 | 请求参数错误 | 请求参数格式不正确或缺少必要参数 | 检查请求参数格式和必填字段 |
| 401 | 未授权 | 缺少认证信息或认证信息无效 | 检查 Authorization 头部是否正确 |
| 403 | 禁止访问 | 用户无权限访问该资源 | 检查用户权限或联系管理员 |
| 404 | 资源不存在 | 请求的资源不存在 | 检查请求路径和资源ID |
| 405 | 方法不允许 | HTTP 方法不被允许 | 检查请求方法是否正确 |
| 409 | 资源冲突 | 资源已存在或状态冲突 | 检查资源唯一性约束 |
| 422 | 参数验证失败 | 请求参数不符合业务规则 | 检查参数值是否符合业务要求 |
| 429 | 请求过于频繁 | 超出API调用频率限制 | 降低请求频率或联系管理员 |

### 5xx 服务器错误

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 500 | 内部服务器错误 | 服务器内部发生错误 | 联系技术支持 |
| 502 | 网关错误 | 上游服务器响应无效 | 检查服务状态或稍后重试 |
| 503 | 服务不可用 | 服务器暂时无法处理请求 | 稍后重试或联系技术支持 |
| 504 | 网关超时 | 上游服务器响应超时 | 稍后重试或联系技术支持 |

## 业务错误码

### 认证相关错误 (1000-1999)

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 1001 | 登录凭证无效 | 微信登录code无效或已过期 | 重新获取微信登录code |
| 1002 | AppId不存在 | 指定的微信小程序AppId不存在 | 检查AppId是否正确 |
| 1003 | AppSecret错误 | 微信小程序AppSecret配置错误 | 检查AppSecret配置 |
| 1004 | 微信API调用失败 | 调用微信接口失败 | 检查网络连接或稍后重试 |
| 1005 | Token已过期 | JWT Token已过期 | 重新登录获取新Token |
| 1006 | Token格式错误 | JWT Token格式不正确 | 检查Token格式 |
| 1007 | Token签名无效 | JWT Token签名验证失败 | 重新登录获取新Token |
| 1008 | 用户已被禁用 | 用户账号已被禁用 | 联系管理员解除禁用 |

### 应用管理错误 (2000-2999)

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 2001 | 应用不存在 | 指定的应用ID不存在 | 检查应用ID是否正确 |
| 2002 | 应用名称已存在 | 应用名称重复 | 使用不同的应用名称 |
| 2003 | AppId已存在 | 微信小程序AppId重复 | 使用不同的AppId |
| 2004 | 应用已被禁用 | 应用状态为禁用 | 联系管理员启用应用 |
| 2005 | 应用创建失败 | 应用创建过程中发生错误 | 检查参数或联系技术支持 |
| 2006 | 应用更新失败 | 应用更新过程中发生错误 | 检查参数或联系技术支持 |
| 2007 | 应用删除失败 | 应用删除过程中发生错误 | 检查是否存在关联数据 |
| 2008 | 应用权限不足 | 用户无权限操作该应用 | 检查用户权限 |

### 用户管理错误 (3000-3999)

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 3001 | 用户不存在 | 指定的用户ID不存在 | 检查用户ID是否正确 |
| 3002 | 用户信息更新失败 | 用户信息更新过程中发生错误 | 检查参数或联系技术支持 |
| 3003 | 用户已存在 | 用户在该应用中已存在 | 检查用户关联关系 |
| 3004 | 用户关联失败 | 用户与应用关联失败 | 检查参数或联系技术支持 |
| 3005 | 昵称格式错误 | 用户昵称格式不符合要求 | 检查昵称长度和字符 |
| 3006 | 头像URL无效 | 头像URL格式不正确 | 检查URL格式 |

### 数据库相关错误 (4000-4999)

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 4001 | 数据库连接失败 | 无法连接到数据库 | 检查数据库服务状态 |
| 4002 | 数据库操作超时 | 数据库操作执行超时 | 稍后重试或联系技术支持 |
| 4003 | 数据完整性约束违反 | 违反数据库约束条件 | 检查数据唯一性和外键关系 |
| 4004 | 数据库事务回滚 | 事务执行失败并回滚 | 检查操作逻辑或联系技术支持 |

### 外部服务错误 (5000-5999)

| 错误码 | 说明 | 描述 | 解决方案 |
|--------|------|------|----------|
| 5001 | 微信服务不可用 | 微信API服务不可用 | 稍后重试或联系微信技术支持 |
| 5002 | 微信API限流 | 超出微信API调用频率限制 | 降低调用频率 |
| 5003 | 微信返回数据异常 | 微信API返回数据格式异常 | 联系技术支持 |

## 错误响应格式

所有错误响应都遵循统一格式：

```json
{
  "code": 400,
  "message": "请求参数错误：缺少必要参数 appId",
  "data": null,
  "timestamp": "2024-01-01T12:00:00Z",
  "path": "/auth/mini-program/login",
  "error": {
    "type": "VALIDATION_ERROR",
    "details": [
      {
        "field": "appId",
        "message": "appId不能为空"
      }
    ]
  }
}
```

### 错误响应字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| code | Integer | HTTP状态码 |
| message | String | 错误描述信息 |
| data | Object | 响应数据，错误时通常为null |
| timestamp | String | 错误发生时间 |
| path | String | 请求路径 |
| error | Object | 详细错误信息 |
| error.type | String | 错误类型 |
| error.details | Array | 详细错误列表（参数验证错误时使用） |

## 错误处理建议

### 客户端处理

1. **重试机制**: 对于5xx错误和网络超时，建议实现指数退避重试
2. **用户提示**: 根据错误码提供友好的用户提示信息
3. **日志记录**: 记录错误信息用于问题排查
4. **降级处理**: 对于非关键功能，实现降级处理逻辑

### 服务端监控

1. **错误统计**: 监控各类错误的发生频率
2. **告警机制**: 对于高频错误设置告警
3. **性能监控**: 监控API响应时间和成功率
4. **日志分析**: 定期分析错误日志，优化系统稳定性

## 常见问题解决

### Q: 收到401错误怎么办？
A: 检查请求头中的Authorization字段是否正确，Token是否过期，如果过期需要重新登录。

### Q: 微信登录失败怎么办？
A: 检查微信登录code是否有效，AppId和AppSecret配置是否正确，网络连接是否正常。

### Q: 数据库相关错误怎么处理？
A: 首先检查数据格式和约束条件，如果问题持续存在，联系技术支持团队。

### Q: 如何避免API调用频率限制？
A: 实现合理的缓存机制，避免重复调用，使用批量接口减少调用次数。

## 版本信息

- **文档版本**: 1.0.0
- **作者**: Ravey
- **最后更新**: 2024-01-01

## 联系方式

如遇到文档中未涵盖的错误码或需要技术支持，请联系开发团队。