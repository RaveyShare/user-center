# User Center é¡¹ç›®æ€»è§ˆ

**ä½œè€…**: Ravey  
**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¶é—´**: 2024å¹´

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

User Center æ˜¯ä¸€ä¸ªåŸºäº Spring Boot çš„å¤šåº”ç”¨ç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿï¼Œä¸ºå¤šä¸ªå¾®ä¿¡å°ç¨‹åºæä¾›ç»Ÿä¸€çš„ç”¨æˆ·è®¤è¯ã€æˆæƒå’Œç®¡ç†æœåŠ¡ã€‚ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šåº”ç”¨æ¥å…¥å’Œç»Ÿä¸€ç”¨æˆ·ç®¡ç†ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **å¾®ä¿¡å°ç¨‹åºç™»å½•è®¤è¯**ï¼šæ”¯æŒå¾®ä¿¡å°ç¨‹åºä¸€é”®æˆæƒç™»å½•ï¼Œé›†æˆå¾®ä¿¡API
- **å¤šåº”ç”¨ç»Ÿä¸€ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªå°ç¨‹åºåº”ç”¨çš„ç”¨æˆ·æ•°æ®å’Œå…³è”å…³ç³»
- **JWT Token è®¤è¯**ï¼šå®‰å…¨çš„ä»¤ç‰Œç”Ÿæˆã€éªŒè¯å’Œç®¡ç†æœºåˆ¶
- **ç”¨æˆ·ä¼šè¯ç®¡ç†**ï¼šå®Œæ•´çš„ç”¨æˆ·ç™»å½•ä¼šè¯è·Ÿè¸ªå’Œç®¡ç†
- **åº”ç”¨é…ç½®ç®¡ç†**ï¼šå°ç¨‹åºåº”ç”¨çš„æ³¨å†Œã€é…ç½®å’ŒçŠ¶æ€ç®¡ç†

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Spring Boot 3.2.6
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis 6.0
- **ORM**: MyBatis Plus 3.5
- **è®¤è¯**: JWT + è‡ªå®šä¹‰è¿‡æ»¤å™¨
- **æœåŠ¡å‘ç°**: Nacos 2.0
- **APIæ–‡æ¡£**: Swagger 3 (OpenAPI)
- **æ„å»ºå·¥å…·**: Maven 3.8+
- **JDKç‰ˆæœ¬**: Java 17

### æ¨¡å—æ¶æ„
```
user-center/
â”œâ”€â”€ user-center-api/          # APIæ¥å£å®šä¹‰å±‚
â”œâ”€â”€ user-center-service/      # ä¸šåŠ¡é€»è¾‘å®ç°å±‚  
â”œâ”€â”€ user-center-web/          # Webæ§åˆ¶å±‚
â”œâ”€â”€ user-center-start/        # å¯åŠ¨æ¨¡å—
â””â”€â”€ doc/                      # é¡¹ç›®æ–‡æ¡£
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„
- **apps**: åº”ç”¨ç®¡ç†è¡¨ï¼Œå­˜å‚¨å°ç¨‹åºåº”ç”¨ä¿¡æ¯
- **users**: ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨
- **user_apps**: ç”¨æˆ·åº”ç”¨å…³è”è¡¨ï¼Œæ”¯æŒå¤šåº”ç”¨å…³è”
- **user_sessions**: ç”¨æˆ·ä¼šè¯ç®¡ç†è¡¨

### æ•°æ®åº“å…³ç³»å›¾
```
apps (1) â†â†’ (N) user_apps (N) â†â†’ (1) users
                    â†“
              user_sessions
```

## ğŸ”Œ API æ¥å£

### è®¤è¯æ¥å£
- `POST /auth/wxMiniAppLogin` - å¾®ä¿¡å°ç¨‹åºç™»å½•

### åº”ç”¨ç®¡ç†æ¥å£
- `POST /admin/apps/createApp` - åˆ›å»ºåº”ç”¨
- `POST /admin/apps/getAppList` - è·å–åº”ç”¨åˆ—è¡¨

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

### user-center-api æ¨¡å—
```
src/main/java/com/ravey/ai/user/api/
â”œâ”€â”€ dto/                      # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ AppsDTO.java         # åº”ç”¨DTO
â”‚   â””â”€â”€ UsersDTO.java        # ç”¨æˆ·DTO
â”œâ”€â”€ model/                   # è¯·æ±‚å“åº”æ¨¡å‹
â”‚   â”œâ”€â”€ req/                 # è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ AppCreateReq.java
â”‚   â”‚   â””â”€â”€ MiniProgramLoginReq.java
â”‚   â””â”€â”€ res/                 # å“åº”æ¨¡å‹
â”‚       â”œâ”€â”€ AppRes.java
â”‚       â”œâ”€â”€ AppListRes.java
â”‚       â””â”€â”€ MiniProgramLoginRes.java
â””â”€â”€ service/                 # æœåŠ¡æ¥å£å®šä¹‰
    â”œâ”€â”€ AppsService.java
    â””â”€â”€ AuthService.java
```

### user-center-service æ¨¡å—
```
src/main/java/com/ravey/ai/user/service/
â”œâ”€â”€ dao/                     # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ entity/              # å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ Apps.java
â”‚   â”‚   â”œâ”€â”€ Users.java
â”‚   â”‚   â”œâ”€â”€ UserApps.java
â”‚   â”‚   â””â”€â”€ UserSessions.java
â”‚   â””â”€â”€ mapper/              # MyBatis Mapper
â”œâ”€â”€ converter/               # å®ä½“è½¬æ¢å™¨
â”‚   â”œâ”€â”€ AppsConverter.java
â”‚   â””â”€â”€ UsersConverter.java
â”œâ”€â”€ api/impl/               # æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ AppsServiceImpl.java
â”‚   â””â”€â”€ AuthServiceImpl.java
â””â”€â”€ context/                # ä¸Šä¸‹æ–‡ç®¡ç†
```

### user-center-web æ¨¡å—
```
src/main/java/com/ravey/ai/user/web/
â”œâ”€â”€ controller/             # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ admin/              # ç®¡ç†ç«¯æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ AppsController.java
â”‚   â””â”€â”€ front/              # å‰ç«¯æ§åˆ¶å™¨
â”‚       â””â”€â”€ AuthController.java
â””â”€â”€ filter/                 # è¿‡æ»¤å™¨
    â””â”€â”€ MiniAppTokenFilter.java
```

### user-center-start æ¨¡å—
```
src/main/java/com/ravey/ai/user/start/
â”œâ”€â”€ config/                 # é…ç½®ç±»
â””â”€â”€ UserCenterApplication.java  # å¯åŠ¨ç±»
```

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶
- `bootstrap.yml` - åŸºç¡€é…ç½®ï¼ŒåŒ…å«Nacosé…ç½®ä¸­å¿ƒè¿æ¥
- `application-dev.yml` - å¼€å‘ç¯å¢ƒé…ç½®
- `application-prod.yml` - ç”Ÿäº§ç¯å¢ƒé…ç½®

### å…³é”®é…ç½®é¡¹
```yaml
# æœåŠ¡ç«¯å£
server.port: 8081

# æ•°æ®åº“é…ç½®
spring.datasource:
  url: jdbc:mysql://localhost:3306/user_center
  username: ${DB_USERNAME}
  password: ${DB_PASSWORD}

# Redisé…ç½®
spring.redis:
  host: ${REDIS_HOST}
  port: ${REDIS_PORT}
  password: ${REDIS_PASSWORD}

# JWTé…ç½®
jwt:
  secret: ${JWT_SECRET}
  expiration: 86400000

# å¾®ä¿¡APIé…ç½®
wechat:
  api:
    baseUrl: https://api.weixin.qq.com
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ç¯å¢ƒå‡†å¤‡
1. **Java 17+**
2. **MySQL 8.0+** 
3. **Redis 6.0+**
4. **Nacos 2.0+**

### å¯åŠ¨æ­¥éª¤
1. **æ•°æ®åº“åˆå§‹åŒ–**
   ```bash
   mysql -u root -p user_center < doc/sql/schema.sql
   mysql -u root -p user_center < doc/sql/data.sql
   ```

2. **é…ç½®æ–‡ä»¶å‡†å¤‡**
   - é…ç½® `bootstrap.yml` ä¸­çš„ Nacos è¿æ¥ä¿¡æ¯
   - åœ¨ Nacos é…ç½®ä¸­å¿ƒæ·»åŠ å¯¹åº”ç¯å¢ƒçš„é…ç½®

3. **å¯åŠ¨åº”ç”¨**
   ```bash
   mvn clean package
   java -jar user-center-start/target/user-center-start-1.0.0.jar
   ```

4. **éªŒè¯å¯åŠ¨**
   - è®¿é—® `http://localhost:8081/doc.html` æŸ¥çœ‹ API æ–‡æ¡£
   - æ£€æŸ¥æ—¥å¿—ç¡®è®¤æœåŠ¡æ­£å¸¸å¯åŠ¨

## ğŸ“– æ–‡æ¡£å¯¼èˆª

### è¯¦ç»†æ–‡æ¡£
- [APIæ¥å£æ–‡æ¡£](./api/APIæ¥å£æ–‡æ¡£.md) - å®Œæ•´çš„APIæ¥å£è¯´æ˜
- [æ•°æ®åº“è®¾è®¡è¯´æ˜](./sql/æ•°æ®åº“è®¾è®¡è¯´æ˜.md) - æ•°æ®åº“è¡¨ç»“æ„å’Œè®¾è®¡è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](./deployment/éƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†çš„éƒ¨ç½²é…ç½®æŒ‡å—
- [å¤šåº”ç”¨æ¶æ„æŠ€æœ¯è®¾è®¡æ–‡æ¡£](./architecture/å¤šåº”ç”¨æ¶æ„æŠ€æœ¯è®¾è®¡æ–‡æ¡£.md) - æŠ€æœ¯æ¶æ„è®¾è®¡

### æ•°æ®åº“è„šæœ¬
- [schema.sql](./sql/schema.sql) - æ•°æ®åº“è¡¨ç»“æ„è„šæœ¬
- [data.sql](./sql/data.sql) - åˆå§‹åŒ–æ•°æ®è„šæœ¬

## ğŸ”§ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- æ‰€æœ‰ç±»å’Œæ–¹æ³•å¿…é¡»æ·»åŠ å®Œæ•´çš„ JavaDoc æ³¨é‡Š
- ä½¿ç”¨ `@author ravey` æ ‡æ³¨ä½œè€…ä¿¡æ¯
- éµå¾ªé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œè§„èŒƒ

### å“åº”æ ¼å¼
æ‰€æœ‰ API å“åº”ä½¿ç”¨ç»Ÿä¸€çš„ `HttpResult` æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ",
  "code": "200"
}
```

### å¼‚å¸¸å¤„ç†
- ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€å¤„ç†å¼‚å¸¸
- ä¸šåŠ¡å¼‚å¸¸ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ä¾¿äºæ’æŸ¥

## ğŸ” å…³é”®ä»£ç ä½ç½®

### æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **å¾®ä¿¡ç™»å½•**: `AuthServiceImpl.wxMiniAppLogin()`
- **TokenéªŒè¯**: `MiniAppTokenFilter.doFilter()`
- **åº”ç”¨ç®¡ç†**: `AppsServiceImpl`

### é…ç½®ç±»
- **å¯åŠ¨ç±»**: `UserCenterApplication.java`
- **æ•°æ®åº“é…ç½®**: `application-*.yml`
- **Nacosé…ç½®**: `bootstrap.yml`

### æ•°æ®åº“æ“ä½œ
- **Mapperæ¥å£**: `user-center-service/src/main/java/com/ravey/ai/user/service/dao/mapper/`
- **å®ä½“ç±»**: `user-center-service/src/main/java/com/ravey/ai/user/service/dao/entity/`

## ğŸš¨ æ³¨æ„äº‹é¡¹

### å®‰å…¨é…ç½®
- JWTå¯†é’¥å¿…é¡»ä½¿ç”¨å¼ºå¯†ç å¹¶å®šæœŸæ›´æ¢
- æ•°æ®åº“å¯†ç ä½¿ç”¨åŠ å¯†å­˜å‚¨
- ç”Ÿäº§ç¯å¢ƒç¦ç”¨ Swagger æ–‡æ¡£è®¿é—®

### æ€§èƒ½ä¼˜åŒ–
- Redis ç¼“å­˜ç”¨æˆ·ä¼šè¯ä¿¡æ¯
- æ•°æ®åº“è¿æ¥æ± åˆç†é…ç½®
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ç”¨æˆ·ä¼šè¯

### ç›‘æ§å‘Šè­¦
- å…³æ³¨åº”ç”¨å¯åŠ¨çŠ¶æ€å’Œå¥åº·æ£€æŸ¥
- ç›‘æ§æ•°æ®åº“è¿æ¥å’Œ Redis è¿æ¥çŠ¶æ€
- è®¾ç½®å…³é”®ä¸šåŠ¡æŒ‡æ ‡å‘Šè­¦

---

**ç»´æŠ¤è¯´æ˜**: æœ¬æ–‡æ¡£åŸºäºçœŸå®ä»£ç ç»“æ„ç”Ÿæˆï¼Œå¦‚æœ‰ä»£ç å˜æ›´è¯·åŠæ—¶æ›´æ–°æ–‡æ¡£å†…å®¹ã€‚